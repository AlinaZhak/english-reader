<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>English Reader</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .word { cursor: pointer; color: blue; }
    #popup {
      position: absolute;
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      display: none;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      z-index: 10;
    }
    textarea {
      width: 100%;
      height: 150px;
    }
    #display {
      margin-top: 20px;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <h1>üìö English Reader</h1>

  <p>–í—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç –∫–Ω–∏–≥–∏ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏ —Ñ–∞–π–ª:</p>

  <input type="file" id="fileInput" />
  <br><br>
  <textarea id="textInput" placeholder="–ò–ª–∏ –≤—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç —Å—é–¥–∞..."></textarea>
  <br><br>
  <button onclick="processText()">–ü–æ–∫–∞–∑–∞—Ç—å</button>

  <div id="display"></div>
  <div id="popup"></div>

  <script>
    const popup = document.getElementById("popup");

    function isCommonWord(word) {
      const commonWords = ["the", "be", "to", "of", "and", "a", "in", "that", "have", "I"];
      return commonWords.includes(word.toLowerCase());
    }

    async function translate(word) {
      try {
        const res = await fetch(`/api/translateLibre?word=${word}`);
        const data = await res.json();
        return data.translated || "No translation";
      } catch {
        return "Translation error";
      }
    }

    function showPopup(text, x, y) {
      popup.style.left = x + "px";
      popup.style.top = y + "px";
      popup.innerHTML = text;
      popup.style.display = "block";
    }

    function processText() {
      const raw = document.getElementById("textInput").value;
      const words = raw.split(/\s+/);
      const html = words.map(word => {
        const clean = word.replace(/[.,!?]/g, "");
        return `<span class="word">${word}</span>`;
      }).join(" ");
      document.getElementById("display").innerHTML = html;

      document.querySelectorAll(".word").forEach(el => {
        el.addEventListener("click", async (e) => {
          const word = e.target.innerText.replace(/[.,!?]/g, "");
          const translated = await translate(word);
          const common = isCommonWord(word) ? "‚úÖ –ß–∞—Å—Ç–æ —É–ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç—Å—è" : "‚ùå –†–µ–¥–∫–æ–µ";
          showPopup(`<strong>${word}</strong><br>${translated}<br>${common}`, e.pageX + 10, e.pageY);
        });
      });
    }

    document.getElementById("fileInput").addEventListener("change", function() {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById("textInput").value = e.target.result;
        };
        reader.readAsText(file);
      }
    });

    document.addEventListener("click", (e) => {
      if (!e.target.classList.contains("word")) {
        popup.style.display = "none";
      }
    });
  </script>
</body>
</html>

  </script>
</body>
</html>
